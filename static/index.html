<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Fuel AI</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: { 850: '#151f32', 900: '#0f172a' },
                        primary: { DEFAULT: '#3b82f6', 500: '#3b82f6', 600: '#2563eb' },
                        accent: { DEFAULT: '#10b981', 500: '#10b981' }
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.08); }
        .glass-nav { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-top: 1px solid rgba(255,255,255,0.05); }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .ticker-anim { animation: ticker 60s linear infinite; }
        @keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
        .tool-card { background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(71, 85, 105, 0.5); border-radius: 1rem; padding: 1rem; display: flex; align-items: center; gap: 1rem; cursor: pointer; transition: all 0.3s ease; }
        .tool-card:hover { background: rgba(51, 65, 85, 0.5); transform: scale(1.02); }
        .tool-card:active { transform: scale(0.95); }
        .mask-image-gradient { mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent); -webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent); }
        
        /* Map Overrides */
        .leaflet-container { font-family: 'Inter', sans-serif; z-index: 1; }
        .leaflet-popup-content-wrapper { background: #1e293b; color: white; border-radius: 12px; }
        .leaflet-popup-tip { background: #1e293b; }
    </style>
</head>
<body class="bg-slate-900 text-slate-50 min-h-screen pb-24 md:pb-0 selection:bg-primary-500 selection:text-white">

    <nav class="fixed top-0 inset-x-0 z-50 glass-nav border-b border-slate-800 h-16 flex items-center justify-between px-4 lg:px-8">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center shadow-lg shadow-blue-500/20">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
            </div>
            <span class="font-bold text-lg tracking-tight hidden md:block">Fuel<span class="text-primary-500">AI</span></span>
        </div>

        <div class="hidden md:flex flex-1 mx-8 overflow-hidden h-full items-center max-w-2xl mask-image-gradient">
            <div id="global-ticker" class="whitespace-nowrap text-sm text-slate-400 font-mono flex gap-8">
                </div>
        </div>

        <div class="flex items-center gap-3">
            <select id="state-selector" class="bg-slate-800 border border-slate-700 text-sm rounded-full px-4 py-2 focus:ring-2 focus:ring-primary-500 outline-none hover:border-slate-600 transition-colors cursor-pointer font-medium">
                <option value="QLD">QLD</option>
                <option value="NSW">NSW</option>
                <option value="VIC">VIC</option>
                <option value="SA">SA</option>
                <option value="WA">WA</option>
                <option value="ACT">ACT</option>
                <option value="TAS">TAS</option>
                <option value="NT">NT</option>
            </select>
            
            <div class="hidden md:flex bg-slate-800/50 rounded-full p-1 border border-slate-700/50">
                <button class="nav-btn px-4 py-1.5 rounded-full text-sm font-medium transition-all text-white bg-slate-700 shadow-sm" data-target="live">Live</button>
                <button class="nav-btn px-4 py-1.5 rounded-full text-sm font-medium text-slate-400 hover:text-white transition-all" data-target="drive">Drive</button>
                <button class="nav-btn px-4 py-1.5 rounded-full text-sm font-medium text-slate-400 hover:text-white transition-all" data-target="tools">Hub</button>
            </div>
        </div>
    </nav>

    <main class="pt-20 px-4 lg:px-8 max-w-7xl mx-auto min-h-screen">
        
        <div id="view-live" class="view-section space-y-6 animate-fade-in">
            <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
                <div class="md:col-span-8 glass-panel rounded-3xl p-6 relative overflow-hidden group">
                    <div class="absolute top-0 right-0 p-6 opacity-10 group-hover:opacity-20 transition-opacity">
                        <svg class="w-32 h-32 text-primary-500" fill="currentColor" viewBox="0 0 24 24"><path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/></svg>
                    </div>
                    
                    <div class="relative z-10">
                        <div class="flex items-center gap-3 mb-2">
                            <span class="text-xs font-bold tracking-wider text-slate-400 uppercase">Market Status</span>
                            <span id="last-updated" class="text-[10px] text-slate-500 bg-slate-800/50 px-2 py-0.5 rounded-full">Syncing...</span>
                        </div>
                        <div class="flex items-baseline gap-4 mt-1">
                            <h1 id="status-text" class="text-3xl md:text-5xl font-black text-white tracking-tight">--</h1>
                            <span id="advice-badge" class="px-3 py-1 rounded-full text-xs font-bold bg-slate-700 text-slate-300 uppercase tracking-wide">Standby</span>
                        </div>
                        
                        <p id="savings-insight" class="mt-4 text-lg font-medium text-emerald-400 max-w-lg leading-relaxed">
                            --
                        </p>
                        
                        <div class="mt-6 flex flex-wrap gap-4">
                            <button id="btn-find-near" class="bg-primary-600 hover:bg-primary-500 text-white px-6 py-3 rounded-xl font-semibold shadow-lg shadow-primary-500/20 flex items-center gap-2 transition-all active:scale-95">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                                Find Cheapest
                            </button>
                            <div class="flex flex-col justify-center">
                                <span id="hike-prediction" class="text-xs text-slate-400 font-medium">Est. Next Hike: --</span>
                                <span id="avg-price-display" class="text-xs text-slate-500">Avg: --.-c</span>
                            </div>
                        </div>
                        
                        <div id="near-me-results" class="mt-4 hidden space-y-2"></div>
                    </div>
                </div>

                <div class="md:col-span-4 glass-panel rounded-3xl p-6 flex flex-col justify-between relative overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-br from-indigo-500/10 to-purple-500/10"></div>
                    <div>
                        <div class="text-xs font-bold text-slate-400 uppercase mb-2">Wholesale Price (TGP)</div>
                        <div id="tgp-val" class="text-4xl font-bold text-white tracking-tight">--.-<span class="text-xl text-slate-500">c</span></div>
                    </div>
                    <div class="mt-6 h-32 w-full">
                        <canvas id="cycleChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="glass-panel rounded-3xl p-1 overflow-hidden">
                <div class="relative h-[400px] md:h-[500px] rounded-[20px] overflow-hidden z-0">
                    <div id="map" class="h-full w-full z-0"></div>
                    <div class="absolute top-4 left-4 right-4 md:left-auto md:w-80 z-[400]">
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="h-5 w-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                            </div>
                            <input type="text" id="map-search" class="block w-full pl-10 pr-3 py-3 border border-slate-700/50 rounded-xl leading-5 bg-slate-900/90 backdrop-blur-md text-slate-100 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 sm:text-sm shadow-xl" placeholder="Search suburb or station...">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-drive" class="view-section hidden h-[calc(100vh-6rem)] flex flex-col">
            <div class="flex justify-between items-center mb-6 px-2">
                <div>
                    <div class="text-xs text-slate-400 uppercase font-bold tracking-wider">Current Speed</div>
                    <div id="drive-speed" class="text-3xl font-black text-white">0 <span class="text-sm font-medium text-slate-500">km/h</span></div>
                </div>
                <div class="text-right">
                    <div class="text-xs text-slate-400 uppercase font-bold tracking-wider">GPS Signal</div>
                    <div id="drive-acc" class="text-sm font-bold text-amber-500">Acquiring...</div>
                </div>
            </div>

            <div id="drive-main-card" class="flex-1 glass-panel rounded-3xl border-2 border-slate-700 flex flex-col items-center justify-center text-center p-6 transition-all duration-300 shadow-2xl relative overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-b from-transparent to-slate-900/50"></div>
                <div class="relative z-10">
                    <div class="text-sm text-slate-400 mb-4 font-medium uppercase tracking-widest animate-pulse">Scanning nearby...</div>
                    <div class="big-name text-2xl md:text-4xl font-bold text-white mb-2 leading-tight">--</div>
                    <div class="big-meta text-slate-400 text-lg mb-6">--</div>
                    <div class="big-price text-7xl md:text-9xl font-black text-emerald-400 tracking-tighter drop-shadow-2xl">--.-</div>
                </div>
            </div>

            <a href="#" id="drive-nav-btn" class="mt-6 bg-primary-600 active:bg-primary-700 text-white rounded-2xl p-5 flex items-center justify-center gap-3 font-bold text-lg shadow-lg opacity-50 pointer-events-none transition-all">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/></svg>
                Start Navigation
            </a>
        </div>

        <div id="view-tools" class="view-section hidden pb-20">
            <h2 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                <svg class="w-6 h-6 text-primary-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                Market Tools
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="tool-card group" onclick="app.loadSubView('planner')">
                    <div class="bg-indigo-500/20 p-3 rounded-xl text-indigo-400 group-hover:bg-indigo-500 group-hover:text-white transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0121 18.382V7.618a1 1 0 01-.553-.894L15 4m0 13V4m0 0L9 7"></path></svg>
                    </div>
                    <div>
                        <h3 class="font-bold text-white">Route Planner</h3>
                        <p class="text-sm text-slate-400">Find cheapest stops along your trip</p>
                    </div>
                </div>

                <div class="tool-card group" onclick="app.loadSubView('analytics')">
                    <div class="bg-pink-500/20 p-3 rounded-xl text-pink-400 group-hover:bg-pink-500 group-hover:text-white transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path></svg>
                    </div>
                    <div>
                        <h3 class="font-bold text-white">Analytics & Forecast</h3>
                        <p class="text-sm text-slate-400">Long-term TGP trends & suburb rankings</p>
                    </div>
                </div>

                <div class="tool-card group" onclick="app.loadSubView('ratings')">
                    <div class="bg-amber-500/20 p-3 rounded-xl text-amber-400 group-hover:bg-amber-500 group-hover:text-white transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path></svg>
                    </div>
                    <div>
                        <div class="flex justify-between">
                            <h3 class="font-bold text-white">Station Ratings</h3>
                        </div>
                        <p class="text-sm text-slate-400">Best & worst value stations</p>
                    </div>
                </div>

                <div class="tool-card group" onclick="app.loadSubView('sentiment')">
                    <div class="bg-cyan-500/20 p-3 rounded-xl text-cyan-400 group-hover:bg-cyan-500 group-hover:text-white transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path></svg>
                    </div>
                    <div>
                        <h3 class="font-bold text-white">News Sentiment</h3>
                        <p class="text-sm text-slate-400">Global oil news & analysis</p>
                    </div>
                </div>
            </div>

            <div id="sub-view-container" class="hidden mt-6">
                <button onclick="app.closeSubView()" class="mb-4 text-sm font-medium text-slate-400 hover:text-white flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    Back to Hub
                </button>
                
                <div id="sub-planner" class="sub-view hidden">
                    <div class="glass-panel p-6 rounded-3xl">
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div class="lg:col-span-1 space-y-4">
                                <h3 class="text-lg font-bold text-white">Plan Trip</h3>
                                <input type="text" id="planner-start" class="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-white focus:ring-2 focus:ring-primary-500 outline-none" placeholder="Start Location">
                                <input type="text" id="planner-end" class="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-white focus:ring-2 focus:ring-primary-500 outline-none" placeholder="Destination">
                                <button id="planner-btn" class="w-full bg-primary-600 hover:bg-primary-500 py-3 rounded-xl font-bold text-white shadow-lg">Find Fuel Stops</button>
                                <div id="planner-results"></div>
                            </div>
                            <div class="lg:col-span-2 h-[400px] rounded-2xl overflow-hidden relative z-0">
                                <div id="planner-map" class="h-full w-full z-0"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="sub-analytics" class="sub-view hidden space-y-6">
                    <div class="glass-panel p-6 rounded-3xl">
                        <h3 class="text-lg font-bold text-white mb-4">TGP Forecast</h3>
                        <div class="h-64"><canvas id="analyticsChart"></canvas></div>
                    </div>
                    <div class="glass-panel p-6 rounded-3xl overflow-hidden">
                        <h3 class="text-lg font-bold text-white mb-4">Cheapest Suburbs</h3>
                        <div id="table-suburbs" class="overflow-x-auto"></div>
                    </div>
                </div>

                <div id="sub-ratings" class="sub-view hidden grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="glass-panel p-6 rounded-3xl">
                        <h3 class="text-emerald-400 font-bold mb-4 flex items-center gap-2"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> Best Value Stations</h3>
                        <div id="table-best" class="overflow-x-auto"></div>
                    </div>
                    <div class="glass-panel p-6 rounded-3xl">
                        <h3 class="text-red-400 font-bold mb-4 flex items-center gap-2"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> Most Expensive</h3>
                        <div id="table-worst" class="overflow-x-auto"></div>
                    </div>
                </div>

                <div id="sub-sentiment" class="sub-view hidden grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="glass-panel p-6 rounded-3xl">
                        <h3 class="font-bold text-white mb-4">Global Feed</h3>
                        <div id="feed-global" class="space-y-4"></div>
                    </div>
                    <div class="glass-panel p-6 rounded-3xl">
                        <h3 class="font-bold text-white mb-4">Domestic Feed</h3>
                        <div id="feed-domestic" class="space-y-4"></div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <nav class="md:hidden fixed bottom-4 left-4 right-4 h-16 glass-nav rounded-2xl flex justify-around items-center px-2 z-[1000] shadow-2xl border border-slate-700/50">
        <button class="nav-btn-mobile flex flex-col items-center justify-center w-full h-full text-primary-500" data-target="live">
            <svg class="w-6 h-6 mb-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
            <span class="text-[10px] font-medium">Home</span>
        </button>
        <button class="nav-btn-mobile flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-white" data-target="drive">
            <svg class="w-6 h-6 mb-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
            <span class="text-[10px] font-medium">Drive</span>
        </button>
        <button class="nav-btn-mobile flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-white" data-target="tools">
            <svg class="w-6 h-6 mb-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
            <span class="text-[10px] font-medium">Hub</span>
        </button>
    </nav>

    <style>
    </style>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/static/app.js"></script>
</body>
</html>